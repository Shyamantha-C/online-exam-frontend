<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Result Detail</title>

    <link 
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet">
</head>

<body class="bg-light">

<div class="container py-4">

    <h2 class="text-center mb-4">Detailed Result</h2>

    <div id="student-info" class="mb-4"></div>

    <div id="result-box"></div>

    <div class="text-center mt-4">
        <a href="view-results.html" class="btn btn-secondary">â¬… Back to Results</a>
    </div>
</div>

<script>
const BASE_URL = "https://online-exam-backend-f3rp.onrender.com";
const params = new URLSearchParams(window.location.search);
const attempt_id = params.get("attempt_id");

if (!localStorage.getItem("adminToken")) {
    window.location.href = "admin-login.html";
}

loadDetailed();

async function loadDetailed() {
    const res = await fetch(`${BASE_URL}/api/admin/result/${attempt_id}`, {
        headers: { "X-ADMIN-TOKEN": localStorage.getItem("adminToken") }
    });

    const data = await res.json();

    if (data.status !== "ok") {
        document.getElementById("result-box").innerHTML =
            `<div class='text-danger text-center'>Result not found.</div>`;
        return;
    }

    // Display student info
    const s = data.student;
    document.getElementById("student-info").innerHTML = `
        <div class="card p-3 shadow">
            <h4>${s.name} (${s.roll_no})</h4>
            <p><strong>Score:</strong> ${s.score}</p>
            <p><strong>Started:</strong> ${new Date(s.started_at).toLocaleString()}</p>
            <p><strong>Finished:</strong> ${new Date(s.finished_at).toLocaleString()}</p>
        </div>
    `;

    // Display answers
    let html = "";
    data.answers.forEach((a, i) => {
        html += `
            <div class="card p-3 mt-3 shadow-sm">
                <h5>Q${i+1}. ${a.question}</h5>
                <p><strong>A:</strong> ${a.opt_a}</p>
                <p><strong>B:</strong> ${a.opt_b}</p>
                <p><strong>C:</strong> ${a.opt_c}</p>
                <p><strong>D:</strong> ${a.opt_d}</p>
                <p><strong>Correct:</strong> ${a.correct}</p>
                <p><strong>Selected:</strong> ${a.selected || "Not Answered"}</p>
                <p><strong>Status:</strong> 
                    <span class="${a.status === 'Correct' ? 'text-success' : (a.status === 'Wrong' ? 'text-danger' : 'text-warning')}">
                        ${a.status}
                    </span>
                </p>
            </div>
        `;
    });

    document.getElementById("result-box").innerHTML = html;
}
</script>

</body>
</html>
