<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Result Detail</title>

    <link 
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet">
</head>

<body class="bg-light">

<div class="container py-4">

    <h2 class="text-center mb-4">Result Details</h2>

    <div id="info" class="mb-4"></div>

    <table class="table table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Question</th>
                <th>Correct</th>
                <th>Selected</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="detail-table"></tbody>
    </table>

    <div class="text-center mt-3">
        <a href="view-results.html" class="btn btn-secondary">Back</a>
    </div>

</div>

<script>
const BASE_URL = "https://online-exam-backend-f3rp.onrender.com";

const params = new URLSearchParams(window.location.search);
const attempt_id = params.get("attempt");

loadDetail();

async function loadDetail() {
    const response = await fetch(`${BASE_URL}/api/admin/result/${attempt_id}`, {
        headers: { "X-ADMIN-TOKEN": localStorage.getItem("adminToken") }
    });

    const data = await response.json();

    if (data.status !== "ok") {
        document.getElementById("info").innerHTML =
            "<p class='text-danger'>Error loading result</p>";
        return;
    }

    // Display student info
    const s = data.student;
    document.getElementById("info").innerHTML = `
        <h5>Student: ${s.name} (${s.roll_no})</h5>
        <p>Score: <b>${s.score}</b></p>
        <p>Started: ${new Date(s.started_at).toLocaleString()}</p>
        <p>Finished: ${new Date(s.finished_at).toLocaleString()}</p>
    `;

    // Display questions
    const table = document.getElementById("detail-table");
    table.innerHTML = "";

    data.answers.forEach(a => {
        table.innerHTML += `
            <tr>
                <td>${a.question}</td>
                <td>${a.correct}</td>
                <td>${a.selected || "â€”"}</td>
                <td>${a.status}</td>
            </tr>
        `;
    });
}
</script>

</body>
</html>
