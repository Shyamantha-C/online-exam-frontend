<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Results</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container py-4">

    <div class="text-center mb-4">
        <h2>Exam Results</h2>
        <p class="text-muted">All student attempts</p>
    </div>

    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>#</th>
                <th>Roll No</th>
                <th>Name</th>
                <th>Score</th>
                <th>Started At</th>
                <th>Finished At</th>
                <th>Details</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody id="results-table">
            <!-- Dynamic rows -->
        </tbody>
    </table>

    <div class="text-center mt-3">
        <a href="admin-dashboard.html">‚¨Ö Back to Dashboard</a>
    </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="../admin.js"></script>
<script>
if (!localStorage.getItem("adminToken")) {
    window.location.href = "admin-login.html";
}

loadResults();
</script>

<!-- YE BUTTON KAHIN BHI DAAL DO (student-result-detail.html mein) -->
<div class="text-center my-5">
    <button onclick="magicPrint()" class="btn btn-success btn-lg px-5 shadow-lg fw-bold">
        üñ®Ô∏è PRINT / DOWNLOAD RESULT PDF
    </button>
</div>


<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<script>
async function magicPrint() {
    await new Promise(r => setTimeout(r, 1000));

    const { jsPDF } = window.jspdf;

    const canvas = await html2canvas(document.body, { 
        scale: 2,
        useCORS: true,
        allowTaint: true,
        backgroundColor: '#ffffff'
    });

    const imgData = canvas.toDataURL("image/png");
    const pdf = new jsPDF('p', 'mm', 'a4');

    const imgWidth = 210;
    const imgHeight = (canvas.height * imgWidth) / canvas.width;

    pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
    pdf.save(`Result_${new Date().toISOString().slice(0,10)}.pdf`);
}
</script>